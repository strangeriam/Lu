
if [catch {open "|cmd.exe /c dir" r} pipe ] {
      puts "ERROR: Cannot open pipe : $pipe"
} else {
      puts "OK: Got pipe."
}

fileevent $pipe readable [list READER $pipe]
fconfigure $pipe -blocking 0

proc READER {pipe} {
      if {[eof $pipe]} {
           fileevent $pipe readable {}
           close $pipe
           return
      }

      set data [read $pipe]

      if {[string length $pipe] > 0} {
           puts $data
      }
}

after 5000

#
